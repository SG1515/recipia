<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"

      layout:decorate="~{layout}">

<th:bloack layout:fragment="content">
    <form method="post" th:object="${postFormDto}" enctype="multipart/form-data" th:onsubmit ="return image_check()">
        <input  type="hidden"  th:name="${_csrf.parameterName}"  th:value="${_csrf.token}" />
        <div class="flex flex-col px-60">
            <div>
                <label class="block mb-2 text-sm font-bold text-gray-900">제목</label>
                <input type="text" th:field="*{title}" class="block bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg   w-full p-2.5" placeholder="제목" required>
            </div>
            <div>
                <label class="block mb-2 text-sm font-bold text-gray-900">내용</label>
                <textarea th:field="*{content}" rows="5" class="block p-2.5 w-full text-sm text-gray-900 bg-gray-50 rounded-lg border border-gray-300" placeholder="내용" required></textarea>
            </div>

<!--            <div class="flex flex-col w-full" >-->

                <label class="block mb-2 text-sm font-bold text-gray-900">이미지</label>
                <div data-name="fileDiv">
                    <div class="flex mb-1">
                            <input type="text"   class="text-lg  border rounded-lg font-bold flex-grow" style="background-color: rgba(209, 213, 219, 1);" value="파일1"  readonly/>
                            <label for="file_0" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm p-1  ml-1 w-20">파일선택</label>
                            <input type="file" id="file_0" name="files" onchange="changeFilename(this)" accept=".jpg,.jpeg,.png,.gif,.bmp" hidden>
                            <button type="button" onclick="addFile()" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm p-1  ml-1 w-20"><i class="fa fa-plus" aria-hidden="true"></i></button>
                            <button type="button" onclick="removeFile(this)" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm p-1  ml-1 w-20"><i class="fa fa-minus" aria-hidden="true"></i></button>
                    </div>
                    <div>
                        <img id="LoadImg" class="object-fill w-96 h-96" hidden>
                    </div>
                </div>
<!--            </div>-->

            <div class="btnDiv"th:if="${postFormDto.id == 0}">
                <button type="submit" th:formaction="@{/posts}" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 mt-2">게시물 등록</button>
            </div>
            <div  class="btnDiv" th:if="${postFormDto.id != 0}">
                <button type="submit" th:formaction="@{|/posts/${postFormDto.id}/modify|}" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm px-5 py-2.5 mr-2 mb-2 mt-2">게시물 수정</button>
            </div>
        </div>
    </form>

    <script>
let fileIdx=0;
function changeFilename(file) {
	file = $(file);
	const filename = file[0].files[0].name;
	const target = file.prevAll('input');
	target.val(filename);
	LoadImg(file[0]);
}

	function LoadImg(value)
		{
			if(value.files && value.files[0])
			{
				var reader = new FileReader();

				reader.onload = function (e) {
					$('#LoadImg').attr('src', e.target.result);
				}

				reader.readAsDataURL(value.files[0]);
			}
		}


function addFile() {

	const fileDivs = $('div[data-name="fileDiv"]');
	if (fileDivs.length > 2) {
		alert('파일은 최대 세 개까지 업로드 할 수 있습니다.');
		return false;
	}

	fileIdx++;

	const fileHtml = `
	   <div data-name="fileDiv">
                    <div class="flex mb-1">
                            <input type="text"   class="text-lg  border rounded-lg font-bold flex-grow" style="background-color: rgba(209, 213, 219, 1);" value="파일1"  readonly/>
                            <label for="file_${fileIdx}" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm p-1  ml-1 w-20">파일선택</label>
                            <input type="file" id="file_${fileIdx}" name="files" onchange="changeFilename(this)" accept=".jpg,.jpeg,.png,.gif,.bmp" hidden>
                            <button type="button" onclick="addFile()" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm p-1  ml-1 w-20"><i class="fa fa-plus" aria-hidden="true"></i></button>
                            <button type="button" onclick="removeFile(this)" class="text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:ring-blue-300 font-medium rounded-lg text-sm p-1  ml-1 w-20"><i class="fa fa-minus" aria-hidden="true"></i></button>
                    </div>
                    <div>
                        <img id="LoadImg" class="object-fill w-96 h-96" hidden>
                    </div>
       </div>
	`;

	$('.btnDiv').before(fileHtml);
}

    </script>
</th:bloack>

</html>